<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Papers - KuGuider Admin</title>
  <link rel="icon" href="file_0000000042b861fd808de615ad3ddea5.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --bg-dark: #131314;
      --card-dark: #1e1f20;
      --text-dark: #ececec;
      --subtext-dark: #9e9ea0;
      --border-dark: #2e2f32;
      --nav-bg-dark: #1a1a1a;
      --btn-bg: #fff;
      --btn-text: #000;
    }
    html[data-theme="dark"] {
      --bg: var(--bg-dark);
      --card: var(--card-dark);
      --text: var(--text-dark);
      --subtext: var(--subtext-dark);
      --border: var(--border-dark);
      --nav-bg: var(--nav-bg-dark);
      --btn-bg: #fff;
      --btn-text: #000;
    }
    * {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif;}
    body {background: var(--bg); color: var(--text); min-height:100vh;}
    header {background: var(--nav-bg); padding:2rem 1rem 3rem; text-align:center; border-bottom:1px solid var(--border);}
    .header-img {width:180px; height:90px; object-fit:cover; border-radius:10%;}
    
    .container {padding:2rem 1rem; display:grid; grid-template-columns:repeat(auto-fit, minmax(300px,1fr)); gap:1.2rem;}
    .card {background: var(--card); padding:1.2rem; border-radius:10px; box-shadow:0 0 10px rgba(255,255,255,0.05); border:1px solid var(--border);}
    .card:hover {transform:translateY(-3px); box-shadow:0 0 20px rgba(255,255,255,0.08);}
    .card h2 {font-size:1.1rem; margin-bottom:0.3rem; color:#ffffff;}
    .card p {font-size:0.9rem; color: var(--subtext); margin-bottom:0.8rem;}
    .card a {color:#4da6ff; text-decoration:none; font-size:0.9rem; word-break:break-all;}
      .actions { display:flex; justify-content:flex-end; gap:1.5rem; margin-top:1rem; }
    .btn-icon { background:transparent; border:none; font-size:1.3rem; cursor:pointer; transition:0.2s; }
    .btn-edit { color:#4da6ff; }
    .btn-delete { color:#ff4d4d; }
    .btn-icon:hover { transform:scale(1.2); }
      
    .custom-alert.show {display:flex; animation: fadeInOut 3s ease-in-out forwards;}
    @keyframes fadeInOut {0%{opacity:0;}10%{opacity:1;}90%{opacity:1;}100%{opacity:0;}}
    .modal {position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:10000;}
    .modal-content {background: var(--card); padding:2rem; width:90%; max-width:450px; border-radius:12px; color: var(--text); border:1px solid var(--border);}
    .modal-content input, .modal-content select {width:100%; padding:0.8rem; margin-bottom:1rem; border-radius:6px; border:1px solid var(--border); background: var(--bg); color: var(--text);}
    .modal-content .actions {display:flex; justify-content:space-between; margin-top:1rem;}
    .modal-content .btn {background: var(--btn-bg); color: var(--btn-text); border:none; padding:0.6rem 1.5rem; border-radius:8px; cursor:pointer; transition:0.2s;}
    .modal-content .btn.cancel {background:#444; color:#fff;}
    .modal-content .btn:hover {opacity:0.9;}
  </style>
</head>
<body>
  <header>
    <img src="file_0000000042b861fd808de615ad3ddea5.png" alt="Admin" class="header-img" />
  </header>

  <section class="container" id="papersContainer">
    <p>Loading papers...</p>
  </section>

  <div class="custom-alert" id="alertBox">
    <i class="fa-solid fa-circle-info"></i><span></span>
  </div>

  <!-- Edit Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h3>Edit Paper</h3>
      <input type="text" id="editTitle" placeholder="Paper Title">
      <select id="editSemester">
        <option value="">-- Select Semester --</option>
        <option>Semester 1</option>
        <option>Semester 2</option>
        <option>Semester 3</option>
        <option>Semester 4</option>
        <option>Semester 5</option>
        <option>Semester 6</option>
      </select>
      <input type="text" id="editURL" placeholder="File URL">
      <div class="actions">
        <button class="btn" id="updateBtn">Update</button>
        <button class="btn cancel" onclick="closeEditModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <h3>Confirm Delete</h3>
      <p>Are you sure you want to delete this paper?</p>
      <div class="actions">
        <button class="btn" id="confirmDelete">Yes, Delete</button>
        <button class="btn cancel" onclick="closeDeleteModal()">Cancel</button>
      </div>
    </div>
  </div>

  <footer>Made with ❤️ by Basif Shafi Wani</footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBmbFYqpuqaWCxmh7VqKTb_8CUvyEohzbw",
      authDomain: "kuguider.firebaseapp.com",
      projectId: "kuguider",
      storageBucket: "kuguider.appspot.com",
      messagingSenderId: "483181223164",
      appId: "1:483181223164:web:e35d8ace05364b4d2d8b79"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const container = document.getElementById("papersContainer");
    const alertBox = document.getElementById("alertBox");
    let editId = "";
    let deleteId = "";

    firebase.auth().onAuthStateChanged(user => {
      if(!user) { showAlert("Unauthorized access!"); setTimeout(()=>window.location.href="index.html",2000);}
      else loadPapers();
    });

    function showAlert(msg){
      alertBox.querySelector("span").textContent = msg;
      alertBox.classList.add("show");
      setTimeout(()=>alertBox.classList.remove("show"),3000);
    }

    function logoutUser(){
      firebase.auth().signOut().then(()=>{showAlert("Logged out successfully!"); setTimeout(()=>window.location.href="index.html",1000);});
    }

    function loadPapers(){
      db.collection("papers").orderBy("uploadedAt","desc").onSnapshot(snapshot=>{
        container.innerHTML="";
        if(snapshot.empty){container.innerHTML="<p>No papers found.</p>"; return;}
        snapshot.forEach(doc=>{
          const paper = doc.data();
          const card = document.createElement("div");
          card.classList.add("card");
          card.innerHTML=`
            <h2>${paper.title}</h2>
            <p>${paper.semester}</p>
            <a href="${paper.fileURL}" target="_blank">${paper.fileName}</a>
            <div class="actions">
              <button class="btn-icon btn-edit" onclick="openEditModal('${doc.id}','${paper.title}','${paper.semester}','${paper.fileURL}')"><i class="fa-solid fa-pen-to-square"></i></button>
              <button class="btn-icon btn-delete" onclick="openDeleteModal('${doc.id}')"><i class="fa-solid fa-trash"></i></button>
            </div>`;
          container.appendChild(card);
        });
      });
    }

    function openEditModal(id,title,semester,url){
      editId=id;
      document.getElementById("editTitle").value=title;
      document.getElementById("editSemester").value=semester;
      document.getElementById("editURL").value=url;
      document.getElementById("editModal").style.display="flex";
    }
    function closeEditModal(){document.getElementById("editModal").style.display="none";}
    document.getElementById("updateBtn").addEventListener("click",()=>{
      const title=document.getElementById("editTitle").value.trim();
      const semester=document.getElementById("editSemester").value;
      const fileURL=document.getElementById("editURL").value.trim();
      if(!title || !semester || !fileURL){showAlert("Please fill all fields."); return;}
      db.collection("papers").doc(editId).update({
        title,
        semester,
        fileURL,
        fileName: fileURL.split("/").pop()
      }).then(()=>{showAlert("Paper updated!"); closeEditModal();}).catch(err=>showAlert("Error: "+err.message));
    });

    function openDeleteModal(id){deleteId=id; document.getElementById("deleteModal").style.display="flex";}
    function closeDeleteModal(){document.getElementById("deleteModal").style.display="none";}
    document.getElementById("confirmDelete").addEventListener("click",()=>{
      db.collection("papers").doc(deleteId).delete().then(()=>{showAlert("Paper deleted!"); closeDeleteModal();}).catch(err=>showAlert("Error: "+err.message));
    });
  </script>
</body>
</html>